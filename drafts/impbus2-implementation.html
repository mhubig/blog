<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>IMPBus2 Implementation QuickStart Manual</title>
  <meta name="author" content="Markus Hubig">



  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="http://mhubig.de/favicon.png" rel="icon">
  <link href="http://mhubig.de/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">
  <script src="http://mhubig.de/theme/js/modernizr-2.0.js"></script>
  <script src="http://mhubig.de/theme/js/ender.js"></script>
  <script src="http://mhubig.de/theme/js/octopress.js" type="text/javascript"></script>

  <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="http://mhubig.de/">admin punk and python junk ...</a></h1>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>



<ul class="main-navigation">
    <li >
    <a href="http://mhubig.de/category/administration.html">Administration</a>
    </li>
    <li >
    <a href="http://mhubig.de/category/administration-development.html">Administration, development</a>
    </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">IMPBus2 Implementation QuickStart Manual</h1>
      <p class="meta"><time datetime="2013-06-26T00:00:00" pubdate>Wed 26 June 2013</time></p>
</header>

  <div class="entry-content"><p>This document should be a practical quick-start introduction to the IMPBus2
Protocol by <span class="caps">IMKO</span> GmbH and serves as a practical guideline to implement the
simple commands that are needed to utilize a <span class="caps">IMKO</span> GmbH Pico sensor to start a
measurement and get the resulting data&nbsp;back.</p>
<p>Before diving into more details, let&#8217;s do a quick summary about how the minimal
needed communication loop would look like&nbsp;(Pseudocode!).</p>
<div class="highlight"><pre> <span class="err">#</span> <span class="n">After</span> <span class="n">powering</span> <span class="n">on</span> <span class="n">the</span> <span class="n">probes</span><span class="p">.</span>
 <span class="k">for</span> <span class="n">each</span> <span class="n">sensor</span> <span class="n">in</span> <span class="n">list_of_sensors</span><span class="o">:</span>
     <span class="n">start_measurement</span><span class="p">(</span><span class="n">sensor</span><span class="p">)</span>
     <span class="k">while</span> <span class="n">measurement_running</span><span class="p">(</span><span class="n">sensor</span><span class="p">)</span><span class="o">:</span>
         <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.500</span><span class="p">)</span>
     <span class="n">get_measurement_data</span><span class="p">(</span><span class="n">sensor</span><span class="p">)</span>
</pre></div>


<p>So there are effectively just three commands to&nbsp;implement:</p>
<div class="highlight"><pre><span class="mf">1.</span> <span class="n">start_measurement</span><span class="p">()</span>
<span class="mf">2.</span> <span class="n">measurement_is_running</span><span class="p">()</span>
<span class="mf">3.</span> <span class="n">get_measurement_data</span><span class="p">()</span>
</pre></div>


<blockquote>
<p><strong><span class="caps">NOTE</span></strong><br />
We are developing a reference implementation of the IMPBus2 protocol. The
resulting library is Open Source (<span class="caps">LGPL</span>) so you can easily include this
library into your own application. But since it is written in Python you may
need to port things over to cover you needs. You can find more infomation and
the actual code&nbsp;here:</p>
<p><a href="http://implib2.imko.de">http://implib2.imko.de</a><br />
<a href="https://bitbucket.org/imko/implib2">https://bitbucket.org/imko/implib2</a></p>
<p>This HowTo will include snippets from the implib2 python library and in order
to make it easy for everyone to reproduce the data frames with the correct
<span class="caps">CRC</span> checksum. It is highly recommended to install
<a href="https://bitbucket.org/imko/implib2">implib2</a>, startup a
<a href="http://ipython.org/">ipython</a> shell and prepare the following testing&nbsp;environment:</p>
<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span> <span class="n">from</span> <span class="n">binascii</span> <span class="n">import</span> <span class="n">a2b_hex</span> <span class="n">as</span> <span class="n">a2b</span><span class="p">,</span> <span class="n">b2a_hex</span> <span class="n">as</span> <span class="n">b2a</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">:</span> <span class="n">from</span> <span class="n">implib2</span> <span class="n">import</span> <span class="n">Bus</span><span class="p">,</span> <span class="n">Module</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">:</span> <span class="n">bus</span> <span class="o">=</span> <span class="n">Bus</span><span class="p">(</span><span class="err">&#39;</span><span class="n">loop</span><span class="o">:</span><span class="c1">//&#39;)</span>
</pre></div>


<p>Now it is possible to easily construct IMPBus2 data frames or compute <span class="caps">CRC</span>
checksum with commands like&nbsp;this:</p>
<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">:</span> <span class="n">b2a</span><span class="p">(</span><span class="n">bus</span><span class="p">.</span><span class="n">cmd</span><span class="p">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="mi">324456</span><span class="p">,</span>
  <span class="p">....</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">MEASURE_PARAMETER_TABLE</span><span class="err">&#39;</span><span class="p">,</span>
  <span class="p">....</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">Moist</span><span class="err">&#39;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">fd160368f3047d0a00e7</span><span class="err">&#39;</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">:</span> <span class="n">b2a</span><span class="p">(</span><span class="n">bus</span><span class="p">.</span><span class="n">cmd</span><span class="p">.</span><span class="n">pkg</span><span class="p">.</span><span class="n">crc</span><span class="p">.</span><span class="n">calc_crc</span><span class="p">(</span><span class="n">a2b</span><span class="p">(</span><span class="err">&#39;</span><span class="mf">00168168F</span><span class="mi">304</span><span class="err">&#39;</span><span class="p">)))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">:</span> <span class="err">&#39;</span><span class="mi">9</span><span class="n">b</span><span class="err">&#39;</span>
</pre></div>


</blockquote>
<h2><a id="info"></a> General&nbsp;info</h2>
<p>IMPBus2 is a bus system to which up to 60 single slaves may be connected by a
bi-directional 2-wire line. The IMPBus2 utilize a single master serial bus
protocol. All commands are invoked by the bus master and adressed to one or
more probes. The communication is based on the transmission of address- and
data blocks. Up to 250 bytes of significant data can be transmitted
bi-directional in one&nbsp;telegram.</p>
<h4><a id="addressblock"></a> IMPBus2&nbsp;Adressblock:</h4>
<div class="highlight"><pre><span class="nt">&lt;FD&gt;</span> <span class="nt">&lt;CMD&gt;</span> <span class="nt">&lt;Length&gt;</span> <span class="nt">&lt;Address&gt;</span> <span class="nt">&lt;CRC&gt;</span>
 |    |     |        |         |
 |    |     |        |         `- Maxim/Dallas 1-Wire CRC
 |    |     |        `- Address of the target probe
 |    |     `- Length of the data block
 |    `- Command for the Probe
 `- IMP232N protocol indicator
</pre></div>


<h4><a id="datablock"></a> IMPBus2&nbsp;Datablock:</h4>
<div class="highlight"><pre><span class="nt">&lt;Data&gt;</span> <span class="nt">&lt;CRC&gt;</span>
 |      |
 |      `- Maxim/Dallas 1-Wire CRC
 `- Up to 252 bytes
</pre></div>


<h4><a id="tables"></a>&nbsp;Tables:</h4>
<p>The command structure of the IMPBus2 protocol is table-based. There are tables
such as <strong>system parameter table</strong> or the <strong>action parameter table</strong> and the
<code>&lt;CMD&gt;</code> field in the IMPBus2 Adressblock is used to select the particular
table, either in write or read mode. The <code>&lt;Data&gt;</code> field in the IMPBus2
Datablock is used to select the table <strong>cell</strong> and, optionally, carry the data
to write into the table cell. For more in depth information on the parameter
tables, please refer to the full <a href="http://imko.de/protocol">Protocol Manual</a>.</p>
<h4><a id="address"></a> Address a&nbsp;probe:</h4>
<p>The IMPBus2 address space consists of 4-bytes (0-16.777.215 or 0x00-0xffffff).
To address a probe, the serial number of the probe has to be converted into a
<code>little-endian unsigned int</code> with the most-significant bytes cut&nbsp;off.</p>
<div class="highlight"><pre><span class="n">Y</span>  <span class="n">serial</span> <span class="n">number</span><span class="o">:</span> <span class="mi">324456</span>
<span class="o">|</span>  <span class="n">hex</span><span class="o">:</span> <span class="p">[</span><span class="mo">00</span><span class="p">]</span> <span class="mo">04</span> <span class="n">f3</span> <span class="mi">68</span> <span class="p">(</span><span class="n">Big</span><span class="o">-</span><span class="n">Endian</span><span class="p">)</span>
<span class="o">|</span>  <span class="n">bin</span><span class="o">:</span> <span class="p">[</span><span class="mo">0000</span><span class="o">-</span><span class="mo">0000</span><span class="p">]</span> <span class="mo">0000</span><span class="o">-</span><span class="mo">0100</span> <span class="mi">1111</span><span class="o">-</span><span class="mo">0011</span> <span class="mo">0110</span><span class="o">-</span><span class="mi">1000</span> <span class="p">(</span><span class="n">Big</span><span class="o">-</span><span class="n">Endian</span><span class="p">)</span>
<span class="o">|</span>  <span class="n">bin</span><span class="o">:</span> <span class="mo">0110</span><span class="o">-</span><span class="mi">1000</span> <span class="mi">1111</span><span class="o">-</span><span class="mo">0011</span> <span class="mo">0000</span><span class="o">-</span><span class="mo">0100</span> <span class="p">[</span><span class="mo">0000</span><span class="o">-</span><span class="mo">0000</span><span class="p">]</span> <span class="p">(</span><span class="n">Little</span><span class="o">-</span><span class="n">Endian</span><span class="p">)</span>
<span class="o">|</span>  <span class="n">hex</span><span class="o">:</span> <span class="mi">68</span> <span class="n">f3</span> <span class="mo">04</span> <span class="p">[</span><span class="mo">00</span><span class="p">]</span> <span class="p">(</span><span class="n">Little</span><span class="o">-</span><span class="n">Endian</span><span class="p">)</span>
<span class="n">V</span>  <span class="n">probe</span> <span class="n">address</span><span class="o">:</span> <span class="mf">68f</span><span class="mi">304</span>
</pre></div>


<h4><a id="serial"></a> Setup the serial&nbsp;interface</h4>
<p>Set your serial interface to the following <span class="caps">RS</span>-232C/V24 data&nbsp;format:</p>
<div class="highlight"><pre><span class="mi">1</span> <span class="n">start</span> <span class="n">bit</span>
<span class="mi">8</span> <span class="n">data</span> <span class="n">bits</span>
<span class="mi">1</span> <span class="n">parity</span> <span class="n">bit</span> <span class="p">(</span><span class="n">odd</span> <span class="n">parity</span><span class="p">)</span>
<span class="mi">2</span> <span class="n">stop</span> <span class="n">bits</span>
</pre></div>


<p>You can use the following standard baud rates: <code>1200</code>, <code>2400</code>, <code>4800</code> or
<code>9600</code>.</p>
<h4><a id="crc"></a> Calculation of the <span class="caps">CRC</span>&#8217;s</h4>
<p>The IMPBus2 Protocol uses the Maxim 1-Wire <span class="caps">CRC</span> algorythm to secure the data
transmission. You can use the following (python) code snipped as reference on
how to calculate the <span class="caps">CRC</span>&#8217;s. For more information rever to the Maxim/Dallas
manual <a href="http://datasheets.maximintegrated.com/en/ds/DS18B20.pdf"><span class="caps">DS18B20</span></a></p>
<div class="highlight"><pre><span class="n">tbl</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">94</span><span class="p">,</span> <span class="mi">188</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span>  <span class="mi">97</span><span class="p">,</span>  <span class="mi">63</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="mi">194</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span>
       <span class="mi">32</span><span class="p">,</span> <span class="mi">163</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span>  <span class="mi">31</span><span class="p">,</span>  <span class="mi">65</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span>  <span class="mi">33</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span>
       <span class="mi">64</span><span class="p">,</span>  <span class="mi">30</span><span class="p">,</span>  <span class="mi">95</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span> <span class="mi">227</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span>  <span class="mi">62</span><span class="p">,</span>  <span class="mi">96</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span>  <span class="mi">35</span><span class="p">,</span>
      <span class="mi">125</span><span class="p">,</span> <span class="mi">159</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span>  <span class="mi">66</span><span class="p">,</span>  <span class="mi">28</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span>  <span class="mi">93</span><span class="p">,</span>   <span class="mi">3</span><span class="p">,</span>
      <span class="mi">128</span><span class="p">,</span> <span class="mi">222</span><span class="p">,</span>  <span class="mi">60</span><span class="p">,</span>  <span class="mi">98</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span>   <span class="mi">2</span><span class="p">,</span>  <span class="mi">92</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span>  <span class="mi">99</span><span class="p">,</span>
       <span class="mi">61</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span>  <span class="mi">34</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span>  <span class="mi">29</span><span class="p">,</span>  <span class="mi">67</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>  <span class="mi">70</span><span class="p">,</span>  <span class="mi">24</span><span class="p">,</span>
      <span class="mi">250</span><span class="p">,</span> <span class="mi">164</span><span class="p">,</span>  <span class="mi">39</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">218</span><span class="p">,</span>  <span class="mi">56</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">229</span><span class="p">,</span>
      <span class="mi">187</span><span class="p">,</span>  <span class="mi">89</span><span class="p">,</span>   <span class="mi">7</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span>  <span class="mi">57</span><span class="p">,</span> <span class="mi">186</span><span class="p">,</span> <span class="mi">228</span><span class="p">,</span>   <span class="mi">6</span><span class="p">,</span>  <span class="mi">88</span><span class="p">,</span>
       <span class="mi">25</span><span class="p">,</span>  <span class="mi">71</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">251</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span>  <span class="mi">38</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span>  <span class="mi">59</span><span class="p">,</span> <span class="mi">217</span><span class="p">,</span>
      <span class="mi">135</span><span class="p">,</span>   <span class="mi">4</span><span class="p">,</span>  <span class="mi">90</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">167</span><span class="p">,</span> <span class="mi">249</span><span class="p">,</span>  <span class="mi">27</span><span class="p">,</span>  <span class="mi">69</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span>
      <span class="mi">122</span><span class="p">,</span>  <span class="mi">36</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span>  <span class="mi">68</span><span class="p">,</span>  <span class="mi">26</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">199</span><span class="p">,</span>  <span class="mi">37</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span>  <span class="mi">58</span><span class="p">,</span>
      <span class="mi">100</span><span class="p">,</span> <span class="mi">134</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span>  <span class="mi">91</span><span class="p">,</span>   <span class="mi">5</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span>  <span class="mi">48</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span>
      <span class="mi">237</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span>  <span class="mi">81</span><span class="p">,</span>  <span class="mi">15</span><span class="p">,</span>  <span class="mi">78</span><span class="p">,</span>  <span class="mi">16</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">172</span><span class="p">,</span>  <span class="mi">47</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">147</span><span class="p">,</span>
      <span class="mi">205</span><span class="p">,</span>  <span class="mi">17</span><span class="p">,</span>  <span class="mi">79</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span>  <span class="mi">46</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span>
      <span class="mi">111</span><span class="p">,</span>  <span class="mi">49</span><span class="p">,</span> <span class="mi">178</span><span class="p">,</span> <span class="mi">236</span><span class="p">,</span>  <span class="mi">14</span><span class="p">,</span>  <span class="mi">80</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">241</span><span class="p">,</span>  <span class="mi">19</span><span class="p">,</span>  <span class="mi">77</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span>
      <span class="mi">144</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span>  <span class="mi">44</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span>  <span class="mi">51</span><span class="p">,</span> <span class="mi">209</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span>  <span class="mi">82</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span>
       <span class="mi">50</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">142</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span>  <span class="mi">83</span><span class="p">,</span>  <span class="mi">13</span><span class="p">,</span> <span class="mi">239</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span>  <span class="mi">76</span><span class="p">,</span>
       <span class="mi">18</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span>  <span class="mi">45</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span>  <span class="mi">40</span><span class="p">,</span> <span class="mi">171</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span>
       <span class="mi">23</span><span class="p">,</span>  <span class="mi">73</span><span class="p">,</span>   <span class="mi">8</span><span class="p">,</span>  <span class="mi">86</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span>  <span class="mi">55</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span>  <span class="mi">87</span><span class="p">,</span>
        <span class="mi">9</span><span class="p">,</span> <span class="mi">235</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span>  <span class="mi">54</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">203</span><span class="p">,</span>  <span class="mi">41</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span>
      <span class="mi">244</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span>  <span class="mi">72</span><span class="p">,</span>  <span class="mi">22</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span>  <span class="mi">85</span><span class="p">,</span>  <span class="mi">11</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">214</span><span class="p">,</span>  <span class="mi">52</span><span class="p">,</span>
      <span class="mi">106</span><span class="p">,</span>  <span class="mi">43</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">151</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span>  <span class="mi">74</span><span class="p">,</span>  <span class="mi">20</span><span class="p">,</span> <span class="mi">246</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span>  <span class="mi">42</span><span class="p">,</span>
      <span class="mi">200</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span>  <span class="mi">21</span><span class="p">,</span>  <span class="mi">75</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">247</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">232</span><span class="p">,</span>  <span class="mi">10</span><span class="p">,</span>  <span class="mi">84</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span>
      <span class="mi">137</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">53</span><span class="p">]</span>

<span class="n">def</span> <span class="n">crc</span><span class="p">(</span><span class="n">byte_str</span><span class="p">)</span><span class="o">:</span>
    <span class="k">register</span> <span class="o">=</span> <span class="mh">0x00</span>
    <span class="k">for</span> <span class="kt">char</span> <span class="n">in</span> <span class="n">byte_str</span><span class="o">:</span>
        <span class="n">tbl_idx</span> <span class="o">=</span> <span class="p">(</span><span class="k">register</span> <span class="o">^</span> <span class="n">ord</span><span class="p">(</span><span class="kt">char</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
        <span class="k">register</span> <span class="o">=</span> <span class="p">((</span><span class="k">register</span> <span class="o">&gt;&gt;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="o">^</span> <span class="n">tbl</span><span class="p">[</span><span class="n">tbl_idx</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
    <span class="k">return</span> <span class="n">chr</span><span class="p">(</span><span class="k">register</span><span class="p">)</span> <span class="err">#</span> <span class="kt">unsigned</span> <span class="kt">char</span>
</pre></div>


<h2><a id="measurement"></a> HowTo start a measurement and get the&nbsp;data.</h2>
<p>In this example we assume that we have a single Pico probe connected to our
Master(Computer) via the <span class="caps">RS232</span> serial interface port and a <span class="caps">RS232</span>-to-IMPBus
converter, like the <span class="caps">SM23U</span> or the <span class="caps">SM</span>-<span class="caps">USB</span>. The Pico probe has the serial number
<code>324456</code> and the serial interface is setup <a href="#serial">as stated above</a>.</p>
<ol>
<li>
<p>The communication starts with the master sending the <code>start measurement</code>
    command.</p>
<div class="highlight"><pre><span class="p">,</span><span class="o">-------</span><span class="p">,</span>                    <span class="p">,</span><span class="o">--------</span><span class="p">,</span>
<span class="o">|</span> <span class="n">pico</span>  <span class="o">|-------</span><span class="n">RS232</span><span class="o">--------|</span> <span class="n">Master</span> <span class="o">|</span>
<span class="err">`</span><span class="o">-------</span><span class="err">´</span>                    <span class="err">`</span><span class="o">--------</span><span class="err">´</span>
    <span class="o">^</span>                             <span class="n">V</span>
    <span class="o">|</span><span class="n">_____</span> <span class="n">Start</span> <span class="n">Measurement</span> <span class="n">_____</span><span class="o">|</span>
</pre></div>


<p>As mentioned above [tables], sending a command is synonym to writing
something into a particular table cell on the probe. So in order to start
the measurement we need to write the value <code>1</code> into the <code>StartMeasure</code> cell
of the <code>Action-Parameter-Table</code>. The resulting data frame looks like&nbsp;this:</p>
<div class="highlight"><pre><span class="o">------</span><span class="n">header</span><span class="o">------</span>  <span class="o">---</span><span class="n">data</span><span class="o">----</span>
<span class="n">FD</span> <span class="mi">15</span> <span class="mo">04</span> <span class="mf">68F</span><span class="mi">304</span> <span class="n">B5</span>  <span class="mo">06</span> <span class="mo">00</span> <span class="mo">01</span> <span class="mf">8F</span>
<span class="o">--</span> <span class="o">--</span> <span class="o">--</span> <span class="o">------</span> <span class="o">--</span>  <span class="o">--</span> <span class="o">--</span> <span class="o">--</span> <span class="o">--</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span> <span class="n">of</span> <span class="n">data</span> <span class="n">block</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Value</span> <span class="n">to</span> <span class="n">write</span> <span class="n">into</span> <span class="n">cell</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Always</span> <span class="mh">0x00</span><span class="o">!</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="err">`</span><span class="o">-</span> <span class="n">StartMeasure</span><span class="o">-</span><span class="n">cell</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span> <span class="n">of</span> <span class="n">the</span> <span class="n">first</span> <span class="mi">6</span> <span class="n">Bytes</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Converted</span> <span class="n">address</span> <span class="p">(</span><span class="mi">324456</span><span class="p">)</span> <span class="n">of</span> <span class="n">the</span> <span class="n">probe</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">data</span> <span class="n">block</span> <span class="n">is</span> <span class="mi">4</span> <span class="n">bytes</span>
<span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">SET</span> <span class="n">action</span><span class="o">-</span><span class="n">parameter</span><span class="o">-</span><span class="n">table</span> <span class="n">command</span>
<span class="err">`</span><span class="o">-</span> <span class="n">IMP232N</span> <span class="n">protocol</span> <span class="n">indicator</span>

<span class="cp"># HowTo get this data frame with the IMPLib2</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">:</span> <span class="n">bus</span><span class="p">.</span><span class="n">cmd</span><span class="p">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="mi">324456</span><span class="p">,</span>
<span class="p">...</span><span class="o">:</span>        <span class="err">&#39;</span><span class="n">ACTION_PARAMETER_TABLE</span><span class="err">&#39;</span><span class="p">,</span>
<span class="p">...</span><span class="o">:</span>        <span class="err">&#39;</span><span class="n">StartMeasure</span><span class="err">&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">:</span> <span class="err">&#39;\</span><span class="n">xfd</span><span class="err">\</span><span class="n">x15</span><span class="err">\</span><span class="n">x04h</span><span class="err">\</span><span class="n">xf3</span><span class="err">\</span><span class="n">x04</span><span class="err">\</span><span class="n">xb5</span><span class="err">\</span><span class="n">x06</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x8f</span><span class="err">&#39;</span>
</pre></div>


</li>
<li>
<p>Now the Probe will answer with just a header block that copies the command
    from the request (<span class="caps">SET</span> action-parameter-table). If something goes wrong with
    the first byte of the header will be <code>!= 0</code>.</p>
<div class="highlight"><pre><span class="o">------</span><span class="n">header</span><span class="o">------</span>
<span class="mo">00</span> <span class="mi">15</span> <span class="mo">00</span> <span class="mf">68F</span><span class="mi">304</span> <span class="mi">83</span>
<span class="o">--</span> <span class="o">--</span> <span class="o">--</span> <span class="o">------</span> <span class="o">--</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Converted</span> <span class="n">address</span> <span class="p">(</span><span class="mi">324456</span><span class="p">)</span> <span class="n">of</span> <span class="n">the</span> <span class="n">probe</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">data</span> <span class="n">block</span> <span class="p">(</span><span class="mi">0</span> <span class="o">=</span> <span class="n">no</span> <span class="n">block</span><span class="p">)</span>
<span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">SET</span> <span class="n">action</span><span class="o">-</span><span class="n">parameter</span><span class="o">-</span><span class="n">table</span> <span class="n">command</span>
<span class="err">`</span><span class="o">-</span> <span class="mo">00</span> <span class="n">Error</span> <span class="n">code</span> <span class="p">(</span><span class="mo">00</span> <span class="o">=</span> <span class="n">O</span><span class="p">.</span><span class="n">K</span><span class="p">.)</span>
</pre></div>


</li>
<li>
<p>The measuring is now in progress. When the probe finishes the measuring,
    the value of the <code>Action-Parameter-Table</code> cell <code>StartMeasure</code> will be
    switched back to <code>0</code>. The needed data frame to request the measurement
    state can be constructed as&nbsp;follows:</p>
<div class="highlight"><pre><span class="o">------</span><span class="n">header</span><span class="o">------</span>  <span class="o">--</span><span class="n">data</span><span class="o">--</span>
<span class="n">FD</span> <span class="mi">14</span> <span class="mo">03</span> <span class="mf">68F</span><span class="mi">304</span> <span class="n">FE</span>  <span class="mo">06</span> <span class="mo">00</span> <span class="n">AA</span>
<span class="o">--</span> <span class="o">--</span> <span class="o">--</span> <span class="o">------</span> <span class="o">--</span>  <span class="o">--</span> <span class="o">--</span> <span class="o">--</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span> <span class="n">of</span> <span class="n">data</span> <span class="n">block</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Alwayse</span> <span class="mh">0x00</span><span class="o">!</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="err">`</span><span class="o">-</span> <span class="n">StartMeasure</span><span class="o">-</span><span class="n">cell</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span> <span class="n">of</span> <span class="n">the</span> <span class="n">first</span> <span class="mi">6</span> <span class="n">Bytes</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Converted</span> <span class="n">address</span> <span class="p">(</span><span class="mi">324456</span><span class="p">)</span> <span class="n">of</span> <span class="n">the</span> <span class="n">probe</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">data</span> <span class="n">block</span> <span class="n">is</span> <span class="mi">4</span> <span class="n">bytes</span>
<span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">GET</span> <span class="n">Action</span><span class="o">-</span><span class="n">Parameter</span><span class="o">-</span><span class="n">Table</span> <span class="n">command</span>
<span class="err">`</span><span class="o">-</span> <span class="n">IMP232N</span> <span class="n">protocol</span> <span class="n">indicator</span>

<span class="cp"># HowTo get this data frame with the IMPLib2</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">:</span> <span class="n">bus</span><span class="p">.</span><span class="n">cmd</span><span class="p">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="mi">324456</span><span class="p">,</span>
<span class="p">...</span><span class="o">:</span>             <span class="err">&#39;</span><span class="n">ACTION_PARAMETER_TABLE</span><span class="err">&#39;</span><span class="p">,</span>
<span class="p">...</span><span class="o">:</span>             <span class="err">&#39;</span><span class="n">StartMeasure</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">:</span> <span class="err">&#39;\</span><span class="n">xfd</span><span class="err">\</span><span class="n">x14</span><span class="err">\</span><span class="n">x03h</span><span class="err">\</span><span class="n">xf3</span><span class="err">\</span><span class="n">x04</span><span class="err">\</span><span class="n">xfe</span><span class="err">\</span><span class="n">x06</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">xaa</span><span class="err">&#39;</span>
</pre></div>


<p>And is answered with measurement <strong>in progress</strong> (<code>Value=0x01</code>):</p>
<div class="highlight"><pre><span class="o">------</span><span class="n">header</span><span class="o">------</span>  <span class="o">-</span><span class="n">data</span><span class="o">-</span>
<span class="mo">00</span> <span class="mi">14</span> <span class="mo">02</span> <span class="mf">68F</span><span class="mi">304</span> <span class="mi">49</span>  <span class="mo">01</span>  <span class="mi">5</span><span class="n">E</span>
<span class="o">--</span> <span class="o">--</span> <span class="o">--</span> <span class="o">------</span> <span class="o">--</span>  <span class="o">--</span>  <span class="o">--</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>   <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="err">`</span><span class="o">-</span> <span class="n">Value</span><span class="o">=</span><span class="mh">0x01</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Converted</span> <span class="n">address</span> <span class="p">(</span><span class="mi">324456</span><span class="p">)</span> <span class="n">of</span> <span class="n">the</span> <span class="n">probe</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">data</span> <span class="n">block</span>
<span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">GET</span> <span class="n">action</span><span class="o">-</span><span class="n">parameter</span><span class="o">-</span><span class="n">table</span> <span class="n">command</span>
<span class="err">`</span><span class="o">-</span> <span class="mo">00</span> <span class="n">Error</span> <span class="n">code</span> <span class="p">(</span><span class="mo">00</span> <span class="o">=</span> <span class="n">O</span><span class="p">.</span><span class="n">K</span><span class="p">.)</span>
</pre></div>


<p>And with measurement <strong>finished</strong> (<code>Value=0x00</code>):</p>
<div class="highlight"><pre><span class="o">------</span><span class="n">header</span><span class="o">------</span>  <span class="o">-</span><span class="n">data</span><span class="o">-</span>
<span class="mo">00</span> <span class="mi">14</span> <span class="mo">02</span> <span class="mf">68F</span><span class="mi">304</span> <span class="mi">49</span>  <span class="mo">00</span>  <span class="mo">00</span>
<span class="o">--</span> <span class="o">--</span> <span class="o">--</span> <span class="o">------</span> <span class="o">--</span>  <span class="o">--</span>  <span class="o">--</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>   <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="err">`</span><span class="o">-</span> <span class="n">Value</span><span class="o">=</span><span class="mh">0x00</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Converted</span> <span class="n">address</span> <span class="p">(</span><span class="mi">324456</span><span class="p">)</span> <span class="n">of</span> <span class="n">the</span> <span class="n">probe</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">data</span> <span class="n">block</span>
<span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">GET</span> <span class="n">action</span><span class="o">-</span><span class="n">parameter</span><span class="o">-</span><span class="n">table</span> <span class="n">command</span>
<span class="err">`</span><span class="o">-</span> <span class="mo">00</span> <span class="n">Error</span> <span class="n">code</span> <span class="p">(</span><span class="mo">00</span> <span class="o">=</span> <span class="n">O</span><span class="p">.</span><span class="n">K</span><span class="p">.)</span>
</pre></div>


<p>So we need to start a little loop and wait for the measurement to&nbsp;finish.</p>
<div class="highlight"><pre><span class="k">while</span> <span class="n">measurement_running</span><span class="p">()</span><span class="o">:</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.500</span><span class="p">)</span>
</pre></div>


</li>
<li>
<p>Now all what&#8217;s left to do is to request the measurement data from the
    Probe. The measurement data is stored in the <code>Measure-Parameter-Table</code>.
    To get the moisture data, send the following data&nbsp;frame:</p>
<div class="highlight"><pre><span class="o">------</span><span class="n">header</span><span class="o">------</span>  <span class="o">--</span><span class="n">data</span><span class="o">--</span>
<span class="n">FD</span> <span class="mi">16</span> <span class="mo">03</span> <span class="mf">68F</span><span class="mi">304</span> <span class="mi">7</span><span class="n">D</span>  <span class="mi">0</span><span class="n">A</span> <span class="mo">00</span> <span class="n">E7</span>
<span class="o">--</span> <span class="o">--</span> <span class="o">--</span> <span class="o">------</span> <span class="o">--</span>  <span class="o">--</span> <span class="o">--</span> <span class="o">--</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span> <span class="n">of</span> <span class="n">data</span> <span class="n">block</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Always</span> <span class="mh">0x00</span><span class="o">!</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="err">`</span><span class="o">-</span> <span class="mh">0xFF</span> <span class="n">means</span> <span class="err">&#39;</span><span class="n">get</span> <span class="n">all</span> <span class="n">cells</span><span class="err">&#39;</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span> <span class="n">of</span> <span class="n">the</span> <span class="n">first</span> <span class="mi">6</span> <span class="n">Bytes</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Converted</span> <span class="n">address</span> <span class="p">(</span><span class="mi">324456</span><span class="p">)</span> <span class="n">of</span> <span class="n">the</span> <span class="n">probe</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">data</span> <span class="n">block</span> <span class="n">is</span> <span class="mi">3</span> <span class="n">bytes</span>
<span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">GET</span> <span class="n">Measure</span><span class="o">-</span><span class="n">Parameter</span><span class="o">-</span><span class="n">Table</span> <span class="n">command</span>
<span class="err">`</span><span class="o">-</span> <span class="n">IMP232N</span> <span class="n">protocol</span> <span class="n">indicator</span>

<span class="cp"># HowTo get this data frame with the IMPLib2</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">:</span> <span class="n">b2a</span><span class="p">(</span><span class="n">bus</span><span class="p">.</span><span class="n">cmd</span><span class="p">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="mi">324456</span><span class="p">,</span>
<span class="p">...</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">MEASURE_PARAMETER_TABLE</span><span class="err">&#39;</span><span class="p">,</span>
<span class="p">...</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">Moist</span><span class="err">&#39;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">fd160368f3047d0a00e7</span><span class="err">&#39;</span>
</pre></div>


<p>This will be answerd from the probe with a data frame like this, containing
the moisture&nbsp;value:</p>
<div class="highlight"><pre><span class="o">------</span><span class="n">header</span><span class="o">------</span>  <span class="o">---</span><span class="n">data</span><span class="o">----</span>
<span class="mo">00</span> <span class="mi">16</span> <span class="mi">81</span> <span class="mf">68F</span><span class="mi">304</span> <span class="mi">9</span><span class="n">B</span>  <span class="n">EC51F441</span> <span class="mi">31</span>
<span class="o">--</span> <span class="o">--</span> <span class="o">--</span> <span class="o">------</span> <span class="o">--</span>  <span class="o">--------</span> <span class="o">--</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>        <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span> <span class="n">of</span> <span class="n">Data</span> <span class="n">block</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="err">`</span><span class="o">-</span> <span class="n">Moist</span> <span class="n">value</span> <span class="mi">32</span> <span class="n">Bit</span> <span class="n">Float</span> <span class="p">(</span><span class="mf">30.54</span> <span class="o">%</span><span class="p">)</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span> <span class="n">of</span> <span class="n">the</span> <span class="n">first</span> <span class="mi">6</span> <span class="n">Bytes</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Converted</span> <span class="n">address</span> <span class="p">(</span><span class="mi">324456</span><span class="p">)</span> <span class="n">of</span> <span class="n">the</span> <span class="n">probe</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">data</span> <span class="n">block</span> <span class="n">is</span> <span class="mi">3</span> <span class="n">bytes</span>
<span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">GET</span> <span class="n">Measure</span><span class="o">-</span><span class="n">Parameter</span><span class="o">-</span><span class="n">Table</span> <span class="n">command</span>
<span class="err">`</span><span class="o">-</span> <span class="n">IMP232N</span> <span class="n">protocol</span> <span class="n">indicator</span>
</pre></div>


<p>Or if you need the temperature, send this data&nbsp;frame:</p>
<div class="highlight"><pre><span class="o">------</span><span class="n">header</span><span class="o">------</span>  <span class="o">--</span><span class="n">data</span><span class="o">--</span>
<span class="n">FD</span> <span class="mi">16</span> <span class="mo">03</span> <span class="mf">68F</span><span class="mi">304</span> <span class="mi">7</span><span class="n">D</span>  <span class="mi">0</span><span class="n">D</span> <span class="mo">00</span> <span class="mi">89</span>
<span class="o">--</span> <span class="o">--</span> <span class="o">--</span> <span class="o">------</span> <span class="o">--</span>  <span class="o">--</span> <span class="o">--</span> <span class="o">--</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span> <span class="n">of</span> <span class="n">data</span> <span class="n">block</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Alwayse</span> <span class="mh">0x00</span><span class="o">!</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="err">`</span><span class="o">-</span> <span class="mh">0xFF</span> <span class="n">means</span> <span class="err">&#39;</span><span class="n">get</span> <span class="n">all</span> <span class="n">cells</span><span class="err">&#39;</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span> <span class="n">of</span> <span class="n">the</span> <span class="n">first</span> <span class="mi">6</span> <span class="n">Bytes</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Converted</span> <span class="n">address</span> <span class="p">(</span><span class="mi">324456</span><span class="p">)</span> <span class="n">of</span> <span class="n">the</span> <span class="n">probe</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">data</span> <span class="n">block</span> <span class="n">is</span> <span class="mi">3</span> <span class="n">bytes</span>
<span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">GET</span> <span class="n">Measure</span><span class="o">-</span><span class="n">Parameter</span><span class="o">-</span><span class="n">Table</span> <span class="n">command</span>
<span class="err">`</span><span class="o">-</span> <span class="n">IMP232N</span> <span class="n">protocol</span> <span class="n">indicator</span>

<span class="cp"># HowTo get this data frame with the IMPLib2</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">:</span> <span class="n">b2a</span><span class="p">(</span><span class="n">bus</span><span class="p">.</span><span class="n">cmd</span><span class="p">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="mi">324456</span><span class="p">,</span>
    <span class="p">...</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">MEASURE_PARAMETER_TABLE</span><span class="err">&#39;</span><span class="p">,</span>
    <span class="p">...</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">CompTemp</span><span class="err">&#39;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">fd160368f3047d0d0089</span><span class="err">&#39;</span>
</pre></div>


<p>This will be aswered by the probe&nbsp;with:</p>
<div class="highlight"><pre><span class="o">------</span><span class="n">header</span><span class="o">------</span>  <span class="o">---</span><span class="n">data</span><span class="o">----</span>
<span class="mo">00</span> <span class="mi">16</span> <span class="mi">81</span> <span class="mf">68F</span><span class="mi">304</span> <span class="mi">9</span><span class="n">B</span>  <span class="mo">0000</span><span class="n">ac41</span> <span class="n">BB</span>
<span class="o">--</span> <span class="o">--</span> <span class="o">--</span> <span class="o">------</span> <span class="o">--</span>  <span class="o">--------</span> <span class="o">--</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>        <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span> <span class="n">of</span> <span class="n">Data</span> <span class="n">block</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="err">`</span><span class="o">-</span> <span class="n">Moist</span> <span class="n">value</span> <span class="mi">32</span> <span class="n">Bit</span> <span class="n">Float</span> <span class="p">(</span><span class="mf">21.5</span> <span class="err">°</span><span class="n">C</span><span class="p">)</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>      <span class="err">`</span><span class="o">-</span> <span class="n">CRC</span> <span class="n">of</span> <span class="n">the</span> <span class="n">first</span> <span class="mi">6</span> <span class="n">Bytes</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Converted</span> <span class="n">address</span> <span class="p">(</span><span class="mi">324456</span><span class="p">)</span> <span class="n">of</span> <span class="n">the</span> <span class="n">probe</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">data</span> <span class="n">block</span> <span class="n">is</span> <span class="mi">3</span> <span class="n">bytes</span>
<span class="o">|</span>  <span class="err">`</span><span class="o">-</span> <span class="n">GET</span> <span class="n">Measure</span><span class="o">-</span><span class="n">Parameter</span><span class="o">-</span><span class="n">Table</span> <span class="n">command</span>
<span class="err">`</span><span class="o">-</span> <span class="n">IMP232N</span> <span class="n">protocol</span> <span class="n">indicator</span>
</pre></div>


</li>
<li>
<p>If you have more than one sensor connected to the IMPBus2, you have to
    repeat this process for each&nbsp;sensor.</p>
</li>
</ol></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">Markus Hubig</span>
  </span>
<time datetime="2013-06-26T00:00:00" pubdate>Wed 26 June 2013</time>  <span class="categories">
    <a class="category" href="http://mhubig.de/tag/impbus2.html">impbus2</a>
    <a class="category" href="http://mhubig.de/tag/imko.html">imko</a>
    <a class="category" href="http://mhubig.de/tag/sensor.html">sensor</a>
  </span>
</p><div class="sharing">
</div>    </footer>
  </article>

</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="http://mhubig.de/release-management.html">Release Management Manifest</a>
      </li>
      <li class="post">
          <a href="http://mhubig.de/multiversion-windows7-iso.html">HowTo create a multiversion Windows 7 ISO-Image on Mac</a>
      </li>
      <li class="post">
          <a href="http://mhubig.de/samba-openldap-nis.html">Install and setup Samba and OpenLDAP</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="http://mhubig.de/category/administration.html">administration</a></li>
        <li><a href="http://mhubig.de/category/administration-development.html">administration, development</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="http://mhubig.de/tag/samba.html">samba</a>,    <a href="http://mhubig.de/tag/installation.html">installation</a>,    <a href="http://mhubig.de/tag/release-management.html">release management</a>,    <a href="http://mhubig.de/tag/windows7.html">windows7</a>,    <a href="http://mhubig.de/tag/git.html">git</a>,    <a href="http://mhubig.de/tag/ldap.html">ldap</a>  </section>


    <section>
        <h1>Social</h1>
        <ul>
            <li><a href="http://twitter.com/mhubig" target="_blank">twitter</a></li>
            <li><a href="http://bitbucket.org/mhubig" target="_blank">bitbucket</a></li>
            <li><a href="http://github.com/mhubig" target="_blank">github</a></li>
        </ul>
    </section>
    <section>
        <h1>Blogroll</h1>
        <ul>
            <li><a href="http://imko.de" target="_blank">IMKO GmbH</a></li>
            <li><a href="http://python.org/" target="_blank">Python</a></li>
            <li><a href="http://jinja.pocoo.org/" target="_blank">Jinja2</a></li>
        </ul>
    </section>

</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2013  - Markus Hubig -
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-38038655-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-38038655-1');
    ga('send', 'pageview');
</script>
	<script type="text/javascript">
	  var disqus_shortname = 'mhubig';
          var disqus_identifier = '/impbus2-implementation.html';
          var disqus_url = 'http://mhubig.de/impbus2-implementation.html';
          var disqus_title = 'IMPBus2 Implementation QuickStart&nbsp;Manual';
	  (function() {
	    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	   })();
	</script>
</body>
</html>